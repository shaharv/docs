Docker tips
-----------

Basics:

- Build image                    sudo docker image build -t [image-name]:[version] .
- Run image                      sudo docker run -i -t uuid /bin/ash
- List available images          sudo docker images
- List running images            sudo docker ps
- Connect to running container   sudo docker exec -i -t [container-id] /bin/ash

Copy:

- Copy files from/to container   sudo docker cp <file-or-folder> <container-id>:<dest-folder>

Build and Deploy:

- Build squashed image           sudo docker image build --squash -t <image-name> .
  (requires experimental mode)
- Commit image                   sudo docker commit <container-id> <image-id>[:tag]

Network:

- Connect to localhost (mapped   sudo docker run --network="host" ...
  (to 127.0.0.1 in container)

Cleanup:

- Delete all containers          sudo docker rm $(sudo docker ps -a -q)
- Delete all images              sudo docker rmi $(sudo docker images -q)
- Total docker space usage       sudo docker system df

Inspect:

- List all files in container    sudo docker export <container-id> | tar tfv -
- Get container IP address       sudo docker inspect <container-id> | grep IPAddress

Debug:

- Run gdb capable docker         sudo docker run --cap-add=SYS_PTRACE --security-opt seccomp=unconfined

Search and stats:

- List Dockerhub tags            wget -q https://registry.hub.docker.com/v1/repositories/<repo-name>/tags -O - | jq -r '.[].name'
- Library summary in JSON fmt.   https://hub.docker.com/v2/repositories/library/<repo-name>/
- Pull counts for all images     wget -q https://store.docker.com/api/content/v1/products/search?page_size=100\&q=\&source=verified\&type=image%2Cbundle -O - | jq '.'

Misc:

- Enable experimental features   echo $'{\n    "experimental": true\n}' | sudo tee -a /etc/docker/daemon.json
                                 sudo service docker restart
- Enable core dump               https://dev.to/mizutani/how-to-get-core-file-of-segmentation-fault-process-in-docker-22ii

Useful Links:

- Five Ways to Slim Docker Images
  https://blog.codacy.com/five-ways-to-slim-your-docker-images

